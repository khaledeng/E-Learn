<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Orbital view</title>

<link rel="icon" type="image/png" href="/favicon.png">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Edu+NSW+ACT+Cursive:wght@400..700&family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=Karma:wght@300;400;500;600;700&family=Orbitron:wght@400..900&family=Raleway:ital,wght@0,100..900;1,100..900&display=swap" rel="stylesheet">

<style>
     body {
      background:#0B1B2B; 
      color:#e6f2ff;
       font-family:Inter, 
       system-ui, Arial; }

     .hero { height:220px; display:flex; align-items:center; justify-content:center; gap:20px; }

     .orbit-wrap { width:140px; height:140px; position:relative; }

     .earth { width:100px; 
     height:100px; 
     border-radius:50%; 
     background: radial-gradient(circle at 30% 30%, #4aa, #136); 
     margin:auto; 
     box-shadow:0 6px 18px rgba(0,0,0,.6);
      transform: translateY(10px);}

     .sat { position:absolute; width:18px; height:18px; border-radius:50%; background:#ffd166; display:flex; align-items:center; justify-content:center; font-size:10px; color:#07203c;}
     /* orbits */
     .orbit { position:absolute; left:-20px; top:-20px; width:180px; height:180px; border-radius:50%; border:1px dashed rgba(255,255,255,0.06); }
     @keyframes orbitA { from{ transform: rotate(0deg) translateX(72px) rotate(0deg);} to{ transform: rotate(360deg) translateX(72px) rotate(-360deg);} }
     @keyframes orbitB { from{ transform: rotate(0deg) translateX(52px) rotate(0deg);} to{ transform: rotate(-360deg) translateX(52px) rotate(360deg);} }
     .sat.a { animation: orbitA 14s linear infinite; transform-origin: 50% 50%;}
     .sat.b { animation: orbitB 9s linear infinite; transform-origin: 50% 50%;}
     /* layout */
     #map { height: 420px; border-radius:8px; }
     .card-compact { background: rgba(255,255,255,0.04); border: none; }
     .muted { color: #FFFFFF; }
     .small-note { font-size:0.9rem; color:#bcd; }
</style>
</head>
<body>


<nav class="navbar navbar-dark bg-dark shadow-sm">
     <div class="container">
     <a class="navbar-brand" href="../../Home/Home.html">CosmoLearn — Satellite Explorer</a>
     <div>
     <button class="btn btn-outline-light btn-sm" id="helpBtn">Help</button>
     </div>
     </div>
</nav>


<section class="container hero mt-4">
     <div class="text-start">
     <h1 class="display-6">Satellite Explorer</h1>
     <p class="muted">Interactive satellite passes, Earth imagery, weather & country maps — all in one page.</p>
     <div class="small-note">Tip: Click "Use My Location" then "Find satellites above me".</div>
     </div>

     <div class="orbit-wrap">
     <div class="orbit"></div>
     <div class="earth"></div>
     <div class="sat a">S</div>
     <div class="sat b" style="left:60px; top:10px;">I</div>
     </div>
</section>

<div class="container mt-3">
     <div class="row g-3">

     <div class="col-lg-4">
     <div class="card card-compact p-3 mb-3">
     <h5 style="color: #FFFFFF;">Location</h5>
     <div class="d-grid gap-2">
     <button id="useLocationBtn" class="btn btn-primary">Use My Location</button>
     <div class="input-group">
     <input id="latInput" class="form-control" placeholder="Latitude (or use location)" />
     <input id="lngInput" class="form-control" placeholder="Longitude" />
     </div>
     <small class="muted">Or enter lat/lng manually.</small>
     </div>
     </div>

     <div class="card card-compact p-3 mb-3">
     <h5 style="color: #FFFFFF;">Satellites</h5>
     <div class="mb-2">
     <input id="satIdInput" class="form-control mb-2" placeholder="NORAD ID (e.g. 25544 = ISS)"/>
     <button id="findAboveBtn" class="btn btn-outline-light w-100">Find satellites above me</button>
     <button id="trackIdBtn" class="btn btn-success w-100 mt-2">Track entered NORAD ID</button>
     </div>
     <div id="satList" class="list-group"></div>
     </div>

     <div class="card card-compact p-3 mb-3">
     <h5 style="color: #FFFFFF;">Earth Image (NASA)</h5>
     <p class="muted small-note">Get a satellite image for the chosen lat/lng (uses NASA Earth Imagery API)</p>
     <div class="d-grid gap-2">
     <button id="getImageBtn" class="btn btn-outline-info">Get Latest Satellite Image</button>
     <img id="earthImg" src="" alt="" class="img-fluid mt-2 d-none" style="border-radius:6px;"/>
     <div id="imgInfo" class="muted small-note mt-1"></div>
     </div>
     </div>

     <div class="card card-compact p-3 mb-3">
     <h5 style="color: #FFFFFF;">Weather / Climate</h5>
     <p class="muted small-note">Quick current weather (OpenWeatherMap)</p>
     <div id="weatherBox" style="color: #FFFFFF;"> No weather loaded.</div>
     </div>
     </div>

     <div class="col-lg-8">
     <div class="card card-compact p-3 mb-3">
     <div class="d-flex gap-2 mb-2">
     <input id="countryInput" class="form-control" placeholder="Search country name (e.g. Egypt)" />
     <button id="countryBtn" class="btn btn-outline-light">Show Country</button>
     </div>
     <div id="map"></div>
     <small class="muted">Map: click any satellite in the list to pan to its pass or show satellite path.</small>
     </div>

     <div class="card card-compact p-3">
     <h6 class="muted">Additional Education Modules</h6>
     <ul class="muted">
     <li>Orbit types → interactive demo (LEO / MEO / GEO)</li>
     <li>CubeSat mini-project guide (PDF / notes)</li>
     <li>Remote sensing quick lab: NDVI visualization</li>
     </ul>
     </div>
     </div>
     </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
// The CONFIG object with API keys has been moved to the server file (proxy.js) for security.

// Helper: show small messages
function logResult(text){
    const resultEl = document.getElementById('result');
    if (resultEl) {
        resultEl.innerText = text;
    }
}

/* =========================
   MAP init (Leaflet)
   ========================= */
const map = L.map('map', { zoomControl:true }).setView([26.1626, 32.7094], 5);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
     maxZoom: 19, attribution: '© OpenStreetMap'
}).addTo(map);

let satMarkersLayer = L.layerGroup().addTo(map);
let countryLayer = L.geoJSON(null, { style: { color:'#ffd166', weight:2, fill:false } }).addTo(map);

/* =========================
   UI wiring
   ========================= */
document.getElementById('useLocationBtn').addEventListener('click', () => {
     if(!navigator.geolocation) return alert('Geolocation not supported');
     navigator.geolocation.getCurrentPosition(pos => {
     const lat = pos.coords.latitude.toFixed(5), lon = pos.coords.longitude.toFixed(5);
     document.getElementById('latInput').value = lat;
     document.getElementById('lngInput').value = lon;
     logResult(`Location set: ${lat}, ${lon}`);
     map.setView([lat, lon], 8);
     fetchWeather(lat, lon); // Fetch weather on location change
     }, err => alert('Location error: ' + err.message));
});

document.getElementById('findAboveBtn').addEventListener('click', () => {
     const lat = document.getElementById('latInput').value;
     const lng = document.getElementById('lngInput').value;
     if(!lat || !lng) return alert('Set lat/lng first (Use My Location)');
     fetchSatellitesAbove(lat, lng);
});

document.getElementById('trackIdBtn').addEventListener('click', () => {
     const id = document.getElementById('satIdInput').value;
     if(!id) return alert('Enter NORAD ID');
     // use user's coordinates if present
     const lat = document.getElementById('latInput').value || 26.1626;
     const lng = document.getElementById('lngInput').value || 32.7094;
     fetchPasses(id, lat, lng);
});

document.getElementById('getImageBtn').addEventListener('click', fetchEarthImage);
document.getElementById('countryBtn').addEventListener('click', () => {
     const name = document.getElementById('countryInput').value.trim();
     if(!name) return alert('Enter a country name');
     fetchCountryGeo(name);
});

/* =========================
   N2YO: satellites above
   ========================= */
async function fetchSatellitesAbove(lat, lng){
     const url = `/api/n2yo/above?lat=${lat}&lng=${lng}`; // Updated link to point to your local proxy
     logResult('Searching satellites above...');
     try {
     const res = await fetch(url);
     if(!res.ok) throw new Error('N2YO error: ' + res.status);
     const data = await res.json();
     renderSatList(data.above || []);
     } catch(err){
     console.error(err);
     logResult('Error fetching satellites.');
     }
}

function renderSatList(list){
     const container = document.getElementById('satList');
     container.innerHTML = '';
     satMarkersLayer.clearLayers();
     if(!list || list.length === 0){
     container.innerHTML = '<div class="text-muted">No satellites found above location.</div>';
     return;
     }
     list.forEach(sat => {
     const item = document.createElement('button');
     item.className = 'list-group-item list-group-item-action bg-transparent text-start';
     item.innerHTML = `<strong>${sat.satname}</strong> <div class="muted">ID ${sat.satid}</div>`;
     item.onclick = () => {
     const lat = document.getElementById('latInput').value;
     const lng = document.getElementById('lngInput').value;
     fetchPasses(sat.satid, lat, lng, sat.satname);
     };
     container.appendChild(item);
     });
}

/* =========================
   N2YO: radiopasses for a sat
   ========================= */
async function fetchPasses(satId, lat, lng, niceName){
     const url = `/api/n2yo/passes?satId=${satId}&lat=${lat}&lng=${lng}`; // Updated link to point to your local proxy
     logResult('Fetching pass info...');
     try{
     const res = await fetch(url);
     if(!res.ok) throw new Error('N2YO pass error ' + res.status);
     const data = await res.json();
     if(!data.passes || data.passes.length===0) {
     logResult('No passes found for this satellite in the next days.');
     return;
     }
     const p = data.passes[0];
     const when = new Date(p.startUTC * 1000).toLocaleString();
     logResult(`${niceName||satId} next pass: ${when} • duration ${p.duration}s`);
     // pan map to footprint midpoint if available (use user's coords for demonstration)
     const latU = parseFloat(lat), lngU = parseFloat(lng);
     map.setView([latU, lngU], 6);
     // add marker for user + popup with pass info
     satMarkersLayer.clearLayers();
     L.marker([latU, lngU]).addTo(satMarkersLayer).bindPopup(`${niceName||satId} next pass: ${when}`).openPopup();
     } catch(err){
     console.error(err);
     logResult('Error fetching passes.');
     }
}

/* =========================
   NASA Earth Imagery
   ========================= */
async function fetchEarthImage(){
     const lat = document.getElementById('latInput').value;
     const lng = document.getElementById('lngInput').value;
     if(!lat || !lng) return alert('Set lat/lng first.');
     const url = `/api/nasa/earth-image?lat=${lat}&lng=${lng}`; // Updated link to point to your local proxy
     document.getElementById('imgInfo').innerText = 'Fetching image...';
     try {
     const res = await fetch(url);
     if(!res.ok) throw new Error('NASA error ' + res.status);
     const blob = await res.blob();
     const imgEl = document.getElementById('earthImg');
     imgEl.src = URL.createObjectURL(blob);
     imgEl.classList.remove('d-none');
     document.getElementById('imgInfo').innerText = 'Latest satellite image (from NASA).';
     } catch(e){
     console.error(e);
     document.getElementById('imgInfo').innerText = 'Error getting image.';
     }
}

/* =========================
   OpenWeatherMap (current weather)
   ========================= */
async function fetchWeather(lat, lon){
     const url = `/api/weather?lat=${lat}&lng=${lon}`; // Updated link to point to your local proxy
     try {
     const res = await fetch(url);
     if(!res.ok) throw new Error('OWM ' + res.status);
     const d = await res.json();
     document.getElementById('weatherBox').innerHTML =
     `<strong>${d.name || 'Location'}</strong> — ${d.weather[0].description}. Temp: ${d.main.temp}°C. Wind: ${d.wind.speed} m/s.`;
     } catch(e){
     console.error(e);
     document.getElementById('weatherBox').innerText = 'Weather error.';
     }
}

/* fetch weather when lat/lng changed (simple) */
document.getElementById('latInput').addEventListener('change', () => {
     const lat = document.getElementById('latInput').value, lon = document.getElementById('lngInput').value;
     if(lat && lon) fetchWeather(lat, lon);
});
document.getElementById('lngInput').addEventListener('change', () => {
     const lat = document.getElementById('latInput').value, lon = document.getElementById('lngInput').value;
     if(lat && lon) fetchWeather(lat, lon);
});

/* =========================
   Country lookup (REST Countries v3)
   ========================= */
async function fetchCountryGeo(name){
     try {
     const res = await fetch(`https://restcountries.com/v3.1/name/${encodeURIComponent(name)}?fullText=false`);
     if(!res.ok) throw new Error('Country not found');
     const arr = await res.json();
     const country = arr[0];
     // center map to country's latlng
     const latlng = country.capitalInfo?.latlng || country.latlng;
     if(latlng) {
     map.fitBounds([[latlng[0]-5, latlng[1]-5],[latlng[0]+5, latlng[1]+5]]);
     // mark capital
     L.marker(latlng).addTo(satMarkersLayer).bindPopup(`<strong>${country.name.common}</strong><br>Capital: ${country.capital?.[0] || '—'}`).openPopup();
     }
     // optionally fetch geojson boundary from public source (CORS may block); here we skip heavy boundaries
     document.getElementById('result').innerText = `Showing ${country.name.common}. Capital: ${country.capital?.[0] || '—'}. Population: ${country.population.toLocaleString()}`;
     } catch(e){
     console.error(e);
     alert('Country lookup failed: ' + e.message);
     }
}

/* =========================
   Small help popup
   ========================= */
document.getElementById('helpBtn').addEventListener('click', ()=> {
     alert(`How to use:
1) Click "Use My Location" to auto-fill lat/lng.
2) Click "Find satellites above me" to list satellites overhead (uses N2YO).
3) Click a satellite to fetch its next pass.
4) Click "Get Latest Satellite Image" to fetch NASA Earth imagery for the selected lat/lng.
Notes:
- Your API keys are now securely stored on the server.
- If you get CORS errors, ensure your proxy server is running.`);
});

/* =========================
   Final note: quick default - show ISS next pass for example
   ========================= */
document.addEventListener('DOMContentLoaded', () => {
     // optional: prefill with sample coords
     document.getElementById('latInput').value = '26.1626';
     document.getElementById('lngInput').value = '32.7094';
});
</script>

</body>
</html>